!function(t){t.fn.extend({tableExport:function(e){function n(e,n,a,l){return E=t(w).find(e).first().find(n),E.each(function(){j="",o(this,a,A,l+E.length,function(t,e,n){j+=i(t,e,n)+v.csvSeparator}),j=t.trim(j).substring(0,j.length-1),j.length>0&&(k.length>0&&(k+="\n"),k+=j),A++}),E.length}function o(e,n,o,a,l){if(-1==t.inArray(o,v.ignoreRow)&&-1==t.inArray(o-a,v.ignoreRow)){var r=t(e).filter(function(){return"none"!=t(this).data("tableexport-display")&&(t(this).is(":visible")||"always"==t(this).data("tableexport-display")||"always"==t(this).closest("table").data("tableexport-display"))}).find(n),s=0;r.each(function(e){if(("always"==t(this).data("tableexport-display")||"none"!=t(this).css("display")&&"hidden"!=t(this).css("visibility")&&"none"!=t(this).data("tableexport-display"))&&-1==t.inArray(e,v.ignoreColumn)&&-1==t.inArray(e-r.length,v.ignoreColumn)&&"function"==typeof l){var n,a,i=0,c=0;if("undefined"!=typeof N[o]&&N[o].length>0)for(n=0;e>=n;n++)"undefined"!=typeof N[o][n]&&(l(null,o,n),delete N[o][n],e++);for(t(this).is("[colspan]")&&(i=parseInt(t(this).attr("colspan")),s+=i>0?i-1:0),t(this).is("[rowspan]")&&(c=parseInt(t(this).attr("rowspan"))),l(this,o,e),n=0;i-1>n;n++)l(null,o,e+n);if(c)for(a=1;c>a;a++)for("undefined"==typeof N[o+a]&&(N[o+a]=[]),N[o+a][e+s]="",n=1;i>n;n++)N[o+a][e+s-n]=""}})}}function a(t){if(v.consoleLog===!0&&console.log(t.output()),"string"===v.outputMode)return t.output();if("base64"===v.outputMode)return b(t.output());try{var e=t.output("blob");saveAs(e,v.fileName+".pdf")}catch(n){m(v.fileName+".pdf","data:application/pdf;base64,",t.output())}}function l(t,e,n){var o=0;if("undefined"!=typeof n&&(o=n.colspan),o>=0){for(var a=t.width,l=t.textPos.x,r=e.table.columns.indexOf(e.column),s=1;o>s;s++){var i=e.table.columns[r+s];a+=i.width}if(o>1&&("right"===t.styles.halign?l=t.textPos.x+a-t.width:"center"===t.styles.halign&&(l=t.textPos.x+(a-t.width)/2)),t.width=a,t.textPos.x=l,"undefined"!=typeof n&&n.rowspan>1&&("middle"===t.styles.valign?t.textPos.y=t.textPos.y+t.height*(n.rowspan-1)/2:"bottom"===t.styles.valign&&(t.textPos.y+=(n.rowspan-1)*t.height),t.height=t.height*n.rowspan),"middle"===t.styles.valign||"bottom"===t.styles.valign){var c="string"==typeof t.text?t.text.split(/\r\n|\r|\n/g):t.text,d=c.length||1;d>2&&(t.textPos.y-=(2-x)/2*e.row.styles.fontSize*(d-2)/3)}return!0}return!1}function r(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function s(t,e,n){return t.replace(new RegExp(r(e),"g"),n)}function i(t,e,n){var o="";if(null!=t){var a=d(t,e,n),l=null===a||""==a?"":a.toString();a instanceof Date?o=v.csvEnclosure+a.toLocaleString()+v.csvEnclosure:(o=s(l,v.csvEnclosure,v.csvEnclosure+v.csvEnclosure),(o.indexOf(v.csvSeparator)>=0||/[\r\n ]/g.test(o))&&(o=v.csvEnclosure+o+v.csvEnclosure))}return o}function c(t){return t=t||"0",t=s(t,v.numbers.html.decimalMark,"."),t=s(t,v.numbers.html.thousandsSeparator,""),"number"==typeof t||jQuery.isNumeric(t)!==!1?t:!1}function d(e,n,o){var a="";if(null!=e){var l,r=t(e);if(l=r[0].hasAttribute("data-tableexport-value")?r.data("tableexport-value"):r.html(),"function"==typeof v.onCellHtmlData&&(l=v.onCellHtmlData(r,n,o,l)),v.htmlContent===!0)a=t.trim(l);else{var s=l.replace(/\n/g,"\u2028").replace(/<br\s*[\/]?>/gi,"⁠"),i=t("<div/>").html(s).contents();if(s="",t.each(i.text().split("\u2028"),function(e,n){e>0&&(s+=" "),s+=t.trim(n)}),t.each(s.split("⁠"),function(e,n){e>0&&(a+="\n"),a+=t.trim(n).replace(/\u00AD/g,"")}),v.numbers.html.decimalMark!=v.numbers.output.decimalMark||v.numbers.html.thousandsSeparator!=v.numbers.output.thousandsSeparator){var d=c(a);if(d!==!1){var f=(""+d).split(".");1==f.length&&(f[1]="");var u=f[0].length>3?f[0].length%3:0;a=(0>d?"-":"")+(v.numbers.output.thousandsSeparator?(u?f[0].substr(0,u)+v.numbers.output.thousandsSeparator:"")+f[0].substr(u).replace(/(\d{3})(?=\d)/g,"$1"+v.numbers.output.thousandsSeparator):f[0])+(f[1].length?v.numbers.output.decimalMark+f[1]:"")}}}v.escape===!0&&(a=escape(a)),"function"==typeof v.onCellData&&(a=v.onCellData(r,n,o,a))}return a}function f(t,e,n){return e+"-"+n.toLowerCase()}function u(t,e){var n=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,o=n.exec(t),a=e;return o&&(a=[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]),a}function p(e){var n=h(e,"text-align"),o=h(e,"font-weight"),a=h(e,"font-style"),l="";return"start"==n&&(n="rtl"==h(e,"direction")?"right":"left"),o>=700&&(l="bold"),"italic"==a&&(l+=a),""==l&&(l="normal"),{style:{align:n,bcolor:u(h(e,"background-color"),[255,255,255]),color:u(h(e,"color"),[0,0,0]),fstyle:l},colspan:parseInt(t(e).attr("colspan"))||0,rowspan:parseInt(t(e).attr("rowspan"))||0}}function h(t,e){try{return window.getComputedStyle?(e=e.replace(/([a-z])([A-Z])/,f),window.getComputedStyle(t,null).getPropertyValue(e)):t.currentStyle?t.currentStyle[e]:t.style[e]}catch(n){}return""}function y(t,e,n){var o=100,a=h(t,e),l=a.match(/\d+/);if(null!==l){l=l[0];var r=document.createElement("div");r.style.overflow="hidden",r.style.visibility="hidden",t.parentElement.appendChild(r),r.style.width=o+n;var s=o/r.offsetWidth;return t.parentElement.removeChild(r),l*s}return 0}function m(t,e,n){var o=window.navigator.userAgent;if(o.indexOf("MSIE ")>0||o.match(/Trident.*rv\:11\./)){var a=document.createElement("iframe");a&&(document.body.appendChild(a),a.setAttribute("style","display:none"),a.contentDocument.open("txt/html","replace"),a.contentDocument.write(n),a.contentDocument.close(),a.focus(),a.contentDocument.execCommand("SaveAs",!0,t),document.body.removeChild(a))}else{var l=document.createElement("a");l&&(l.style.display="none",l.download=t,e.toLowerCase().indexOf("base64,")>=0?l.href=e+b(n):l.href=e+encodeURIComponent(n),document.body.appendChild(l),document.createEvent?(null==C&&(C=document.createEvent("MouseEvents")),C.initEvent("click",!0,!1),l.dispatchEvent(C)):document.createEventObject?l.fireEvent("onclick"):"function"==typeof l.onclick&&l.onclick(),document.body.removeChild(l))}}function g(t){t=t.replace(/\x0d\x0a/g,"\n");for(var e="",n=0;n<t.length;n++){var o=t.charCodeAt(n);128>o?e+=String.fromCharCode(o):o>127&&2048>o?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}function b(t){var e,n,o,a,l,r,s,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",d=0;for(t=g(t);d<t.length;)e=t.charCodeAt(d++),n=t.charCodeAt(d++),o=t.charCodeAt(d++),a=e>>2,l=(3&e)<<4|n>>4,r=(15&n)<<2|o>>6,s=63&o,isNaN(n)?r=s=64:isNaN(o)&&(s=64),c=c+i.charAt(a)+i.charAt(l)+i.charAt(r)+i.charAt(s);return c}var v={consoleLog:!1,csvEnclosure:'"',csvSeparator:",",csvUseBOM:!0,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],ignoreRow:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{styles:{cellPadding:2,rowHeight:12,fontSize:8,fillColor:255,textColor:50,fontStyle:"normal",overflow:"ellipsize",halign:"left",valign:"middle"},headerStyles:{fillColor:[52,73,94],textColor:255,fontStyle:"bold",halign:"center"},alternateRowStyles:{fillColor:245},tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},numbers:{html:{decimalMark:".",thousandsSeparator:","},output:{decimalMark:".",thousandsSeparator:","}},onCellData:null,onCellHtmlData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"},x=1.15,w=this,C=null,S=[],E=[],A=0,N=[],j="";if(t.extend(!0,v,e),"csv"==v.type||"txt"==v.type){var k="",M=0;if(A=0,M+=n("thead",v.theadSelector,"th,td",M),M+=n("tbody",v.tbodySelector,"td",M),n("tfoot",v.tbodySelector,"td",M),k+="\n",v.consoleLog===!0&&console.log(k),"string"===v.outputMode)return k;if("base64"===v.outputMode)return b(k);try{var P=new Blob([k],{type:"text/"+("csv"==v.type?"csv":"plain")+";charset=utf-8"});saveAs(P,v.fileName+"."+v.type,"csv"!=v.type||v.csvUseBOM===!1)}catch(D){m(v.fileName+"."+v.type,"data:text/"+("csv"==v.type?"csv":"plain")+";charset=utf-8,"+("csv"==v.type&&v.csvUseBOM?"\ufeff":""),k)}}else if("sql"==v.type){A=0;var L="INSERT INTO `"+v.tableName+"` (";if(S=t(w).find("thead").first().find(v.theadSelector),S.each(function(){o(this,"th,td",A,S.length,function(t,e,n){L+="'"+d(t,e,n)+"',"}),A++,L=t.trim(L),L=t.trim(L).substring(0,L.length-1)}),L+=") VALUES ",E=t(w).find("tbody").first().find(v.tbodySelector),E.each(function(){j="",o(this,"td",A,S.length+E.length,function(t,e,n){j+="'"+d(t,e,n)+"',"}),j.length>3&&(L+="("+j,L=t.trim(L).substring(0,L.length-1),L+="),"),A++}),L=t.trim(L).substring(0,L.length-1),L+=";",v.consoleLog===!0&&console.log(L),"string"===v.outputMode)return L;if("base64"===v.outputMode)return b(L);try{var P=new Blob([L],{type:"text/plain;charset=utf-8"});saveAs(P,v.fileName+".sql")}catch(D){m(v.fileName+".sql","data:application/sql;charset=utf-8,",L)}}else if("json"==v.type){var O=[];S=t(w).find("thead").first().find(v.theadSelector),S.each(function(){var t=[];o(this,"th,td",A,S.length,function(e,n,o){t.push(d(e,n,o))}),O.push(t)});var T=[];E=t(w).find("tbody").first().find(v.tbodySelector),E.each(function(){var t=[];o(this,"td",A,S.length+E.length,function(e,n,o){t.push(d(e,n,o))}),t.length>0&&(1!=t.length||""!=t[0])&&T.push(t),A++});var B=[];B.push({header:O,data:T});var I=JSON.stringify(B);if(v.consoleLog===!0&&console.log(I),"string"===v.outputMode)return I;if("base64"===v.outputMode)return b(I);try{var P=new Blob([I],{type:"application/json;charset=utf-8"});saveAs(P,v.fileName+".json")}catch(D){m(v.fileName+".json","data:application/json;charset=utf-8;base64,",I)}}else if("xml"===v.type){A=0;var R='<?xml version="1.0" encoding="utf-8"?>';R+="<tabledata><fields>",S=t(w).find("thead").first().find(v.theadSelector),S.each(function(){o(this,"th,td",A,E.length,function(t,e,n){R+="<field>"+d(t,e,n)+"</field>"}),A++}),R+="</fields><data>";var W=1;if(E=t(w).find("tbody").first().find(v.tbodySelector),E.each(function(){var t=1;j="",o(this,"td",A,S.length+E.length,function(e,n,o){j+="<column-"+t+">"+d(e,n,o)+"</column-"+t+">",t++}),j.length>0&&"<column-1></column-1>"!=j&&(R+='<row id="'+W+'">'+j+"</row>",W++),A++}),R+="</data></tabledata>",v.consoleLog===!0&&console.log(R),"string"===v.outputMode)return R;if("base64"===v.outputMode)return b(R);try{var P=new Blob([R],{type:"application/xml;charset=utf-8"});saveAs(P,v.fileName+".xml")}catch(D){m(v.fileName+".xml","data:application/xml;charset=utf-8;base64,",R)}}else if("excel"==v.type||"xls"==v.type||"word"==v.type||"doc"==v.type){var H="excel"==v.type||"xls"==v.type?"excel":"word",U="excel"==H?"xls":"doc",z="xls"==U?'xmlns:x="urn:schemas-microsoft-com:office:excel"':'xmlns:w="urn:schemas-microsoft-com:office:word"',q=t(w).filter(function(){return"none"!=t(this).data("tableexport-display")&&(t(this).is(":visible")||"always"==t(this).data("tableexport-display"))}),K="";q.each(function(){A=0,K+="<table><thead>",S=t(this).find("thead").first().find(v.theadSelector),S.each(function(){j="",o(this,"th,td",A,S.length,function(e,n,o){if(null!=e){j+='<th style="';for(var a in v.excelstyles)v.excelstyles.hasOwnProperty(a)&&(j+=v.excelstyles[a]+": "+t(e).css(v.excelstyles[a])+";");t(e).is("[colspan]")&&(j+='" colspan="'+t(e).attr("colspan")),t(e).is("[rowspan]")&&(j+='" rowspan="'+t(e).attr("rowspan")),j+='">'+d(e,n,o)+"</th>"}}),j.length>0&&(K+="<tr>"+j+"</tr>"),A++}),K+="</thead><tbody>",E=t(this).find("tbody").first().find(v.tbodySelector),E.each(function(){j="",o(this,"td",A,S.length+E.length,function(e,n,o){if(null!=e){j+='<td style="';for(var a in v.excelstyles)v.excelstyles.hasOwnProperty(a)&&(j+=v.excelstyles[a]+": "+t(e).css(v.excelstyles[a])+";");t(e).is("[colspan]")&&(j+='" colspan="'+t(e).attr("colspan")),t(e).is("[rowspan]")&&(j+='" rowspan="'+t(e).attr("rowspan")),j+='">'+d(e,n,o)+"</td>"}}),j.length>0&&(K+="<tr>"+j+"</tr>"),A++}),v.displayTableName&&(K+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+d(t("<p>"+v.tableName+"</p>"))+"</td></tr>"),K+="</tbody></table>",v.consoleLog===!0&&console.log(K)});var F='<html xmlns:o="urn:schemas-microsoft-com:office:office" '+z+' xmlns="http://www.w3.org/TR/REC-html40">';if(F+='<meta http-equiv="content-type" content="application/vnd.ms-'+H+'; charset=UTF-8">',F+="<head>","excel"===H&&(F+="<!--[if gte mso 9]>",F+="<xml>",F+="<x:ExcelWorkbook>",F+="<x:ExcelWorksheets>",F+="<x:ExcelWorksheet>",F+="<x:Name>",F+=v.worksheetName,F+="</x:Name>",F+="<x:WorksheetOptions>",F+="<x:DisplayGridlines/>",F+="</x:WorksheetOptions>",F+="</x:ExcelWorksheet>",F+="</x:ExcelWorksheets>",F+="</x:ExcelWorkbook>",F+="</xml>",F+="<![endif]-->"),F+="</head>",F+="<body>",F+=K,F+="</body>",F+="</html>",v.consoleLog===!0&&console.log(F),"string"===v.outputMode)return F;if("base64"===v.outputMode)return b(F);try{var P=new Blob([F],{type:"application/vnd.ms-"+v.type});saveAs(P,v.fileName+"."+U)}catch(D){m(v.fileName+"."+U,"data:application/vnd.ms-"+H+";base64,",F)}}else if("png"==v.type)html2canvas(t(w)[0],{allowTaint:!0,background:"#fff",onrendered:function(t){var e=t.toDataURL();e=e.substring(22);for(var n=atob(e),o=new ArrayBuffer(n.length),a=new Uint8Array(o),l=0;l<n.length;l++)a[l]=n.charCodeAt(l);if(v.consoleLog===!0&&console.log(n),"string"===v.outputMode)return n;if("base64"===v.outputMode)return b(e);try{var r=new Blob([o],{type:"image/png"});saveAs(r,v.fileName+".png")}catch(s){m(v.fileName+".png","data:image/png;base64,",e)}}});else if("pdf"==v.type)if(v.jspdf.autotable===!1){var $={dim:{w:y(t(w).first().get(0),"width","mm"),h:y(t(w).first().get(0),"height","mm")},pagesplit:!1},Q=new jsPDF(v.jspdf.orientation,v.jspdf.unit,v.jspdf.format);Q.addHTML(t(w).first(),v.jspdf.margins.left,v.jspdf.margins.top,$,function(){a(Q)})}else{var V=v.jspdf.autotable.tableExport;if("string"==typeof v.jspdf.format&&"bestfit"===v.jspdf.format.toLowerCase()){var Y={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},G="",J="",Z=0;t(w).filter(":visible").each(function(){if("none"!=t(this).css("display")){var e=y(t(this).get(0),"width","pt");if(e>Z){e>Y.a0[0]&&(G="a0",J="l");for(var n in Y)Y.hasOwnProperty(n)&&Y[n][1]>e&&(G=n,J="l",Y[n][0]>e&&(J="p"));Z=e}}}),v.jspdf.format=""==G?"a4":G,v.jspdf.orientation=""==J?"w":J}V.doc=new jsPDF(v.jspdf.orientation,v.jspdf.unit,v.jspdf.format),t(w).filter(function(){return"none"!=t(this).data("tableexport-display")&&(t(this).is(":visible")||"always"==t(this).data("tableexport-display"))}).each(function(){var e,n=0;if(V.columns=[],V.rows=[],V.rowoptions={},"function"==typeof V.onTable&&V.onTable(t(this),v)===!1)return!0;v.jspdf.autotable.tableExport=null;var a=t.extend(!0,{},v.jspdf.autotable);v.jspdf.autotable.tableExport=V,a.margin={},t.extend(!0,a.margin,v.jspdf.margins),a.tableExport=V,"function"!=typeof a.beforePageContent&&(a.beforePageContent=function(t){if(1==t.pageCount){var e=t.table.rows.concat(t.table.headerRow);e.forEach(function(e){e.height>0&&(e.height+=(2-x)/2*e.styles.fontSize,t.table.height+=(2-x)/2*e.styles.fontSize)})}}),"function"!=typeof a.createdHeaderCell&&(a.createdHeaderCell=function(t,e){if("undefined"!=typeof V.columns[e.column.dataKey]){var n=V.columns[e.column.dataKey];t.styles.halign=n.style.align,"inherit"===a.styles.fillColor&&(t.styles.fillColor=n.style.bcolor),"inherit"===a.styles.textColor&&(t.styles.textColor=n.style.color),"inherit"===a.styles.fontStyle&&(t.styles.fontStyle=n.style.fstyle)}}),"function"!=typeof a.createdCell&&(a.createdCell=function(t,e){var n=V.rowoptions[e.row.index+":"+e.column.dataKey];"undefined"!=typeof n&&"undefined"!=typeof n.style&&(t.styles.halign=n.style.align,"inherit"===a.styles.fillColor&&(t.styles.fillColor=n.style.bcolor),"inherit"===a.styles.textColor&&(t.styles.textColor=n.style.color),"inherit"===a.styles.fontStyle&&(t.styles.fontStyle=n.style.fstyle))}),"function"!=typeof a.drawHeaderCell&&(a.drawHeaderCell=function(t,e){var n=V.columns[e.column.dataKey];return 1!=n.style.hasOwnProperty("hidden")||n.style.hidden!==!0?l(t,e,n):!1}),"function"!=typeof a.drawCell&&(a.drawCell=function(t,e){var n=V.rowoptions[e.row.index+":"+e.column.dataKey];return l(t,e,n)}),S=t(this).find("thead").find(v.theadSelector),S.each(function(){e=0,o(this,"th,td",n,S.length,function(t,n,o){var a=p(t);a.title=d(t,n,o),a.key=e++,V.columns.push(a)}),n++});var r=0;E=t(this).find("tbody").find(v.tbodySelector),E.each(function(){var a=[];e=0,o(this,"td",n,S.length+E.length,function(n,o,l){if("undefined"==typeof V.columns[e]){var s={title:"",key:e,style:{hidden:!0}};V.columns.push(s)}if(null!==n)V.rowoptions[r+":"+e++]=p(n);else{var s=t.extend(!0,{},V.rowoptions[r+":"+(e-1)]);s.colspan=-1,V.rowoptions[r+":"+e++]=s}a.push(d(n,o,l))}),a.length&&(V.rows.push(a),r++),n++}),"function"==typeof V.onBeforeAutotable&&V.onBeforeAutotable(t(this),V.columns,V.rows,a),V.doc.autoTable(V.columns,V.rows,a),"function"==typeof V.onAfterAutotable&&V.onAfterAutotable(t(this),a),v.jspdf.autotable.startY=V.doc.autoTableEndPosY()+a.margin.top}),a(V.doc),V.columns.length=0,V.rows.length=0,delete V.doc,V.doc=null}return this}})}(jQuery);